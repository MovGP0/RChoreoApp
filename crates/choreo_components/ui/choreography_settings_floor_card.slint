import {
    CheckBoxTile,
    CheckState,
    DropDownMenu,
    MaterialPalette,
    MaterialText,
    MenuItem,
    Slider,
    Vertical
} from "@material";
import { ColorPicker } from "color_picker.slint";
import { NumberPicker } from "number_picker.slint";
import { Translations } from "translations.slint";

export component ChoreographySettingsFloorCard inherits Rectangle {
    in property <bool> grid_lines;
    in property <bool> snap_to_grid;
    in property <float> transparency;
    in-out property <color> floor_color;

    in property <[int]> floor_size_options;
    in property <int> floor_front;
    in property <int> floor_back;
    in property <int> floor_left;
    in property <int> floor_right;

    in property <[MenuItem]> grid_size_options;
    in property <int> grid_resolution_index;

    callback update_grid_lines(bool);
    callback update_snap_to_grid(bool);
    callback update_transparency(float);
    callback update_floor_color(color);
    callback update_floor_front(int);
    callback update_floor_back(int);
    callback update_floor_left(int);
    callback update_floor_right(int);
    callback update_grid_resolution(int);

    background: MaterialPalette.surface_container;
    border-width: 1px;
    border-color: MaterialPalette.outline_variant;
    border-radius: 8px;

    Vertical {
        padding: 12px;
        spacing: 8px;

        MaterialText {
            text: Translations.choreography_floor_title;
            font-size: 18px;
        }

        NumberPicker {
            label: Translations.choreography_floor_front_label;
            value: root.floor_front;
            minimum: 1;
            maximum: root.floor_size_options.length > 0
                ? root.floor_size_options[root.floor_size_options.length - 1]
                : 100;
            step: 1;
            value_changed(value) => { root.update_floor_front(value); }
        }

        NumberPicker {
            label: Translations.choreography_floor_back_label;
            value: root.floor_back;
            minimum: 1;
            maximum: root.floor_size_options.length > 0
                ? root.floor_size_options[root.floor_size_options.length - 1]
                : 100;
            step: 1;
            value_changed(value) => { root.update_floor_back(value); }
        }

        NumberPicker {
            label: Translations.choreography_floor_left_label;
            value: root.floor_left;
            minimum: 1;
            maximum: root.floor_size_options.length > 0
                ? root.floor_size_options[root.floor_size_options.length - 1]
                : 100;
            step: 1;
            value_changed(value) => { root.update_floor_left(value); }
        }

        NumberPicker {
            label: Translations.choreography_floor_right_label;
            value: root.floor_right;
            minimum: 1;
            maximum: root.floor_size_options.length > 0
                ? root.floor_size_options[root.floor_size_options.length - 1]
                : 100;
            step: 1;
            value_changed(value) => { root.update_floor_right(value); }
        }

        DropDownMenu {
            label: Translations.choreography_grid_size_label;
            items: root.grid_size_options;
            current_index: root.grid_resolution_index;
            enabled: root.grid_size_options.length > 0;
            selected(index) => {
                root.update_grid_resolution(index + 1);
            }
        }

        HorizontalLayout {
            spacing: 8px;
            MaterialText {
                text: Translations.choreography_grid_lines_label;
                vertical-alignment: center;
                color: MaterialPalette.on_surface_variant;
            }
            Rectangle { horizontal-stretch: 1; background: transparent; }
            CheckBoxTile {
                text: "";
                check_state: root.grid_lines ? CheckState.checked : CheckState.unchecked;
                checked_state_changed(state) => {
                    root.update_grid_lines(state == CheckState.checked);
                }
            }
        }

        HorizontalLayout {
            spacing: 8px;
            MaterialText {
                text: Translations.choreography_snap_to_grid_label;
                vertical-alignment: center;
                color: MaterialPalette.on_surface_variant;
            }
            Rectangle { horizontal-stretch: 1; background: transparent; }
            CheckBoxTile {
                text: "";
                check_state: root.snap_to_grid ? CheckState.checked : CheckState.unchecked;
                checked_state_changed(state) => {
                    root.update_snap_to_grid(state == CheckState.checked);
                }
            }
        }

        MaterialText {
            text: Translations.choreography_transparency_label + ": " + Math.round(root.transparency * 100.0) + "%";
            color: MaterialPalette.on_surface_variant;
        }
        Slider {
            minimum: 0;
            maximum: 1;
            value: root.transparency;
            value_changed(value) => { root.update_transparency(value); }
        }

        MaterialText {
            text: Translations.choreography_floor_color_label;
            color: MaterialPalette.on_surface_variant;
        }
        ColorPicker {
            selected_color: root.floor_color;
            color_changed(color) => { root.update_floor_color(color); }
        }
    }
}
