import { CheckBoxTile, CheckState, MaterialPalette, MaterialText, Slider, TextField, Vertical } from "@material";
import { Date, DatePickerPopup } from "std-widgets.slint";
import { Translations } from "translations.slint";

export component ChoreographySettingsView inherits Rectangle {
    property <[int]> today: SlintInternal.date_now();
    in property <bool> has_selected_scene;
    in property <string> scene_name;
    in property <string> scene_text;
    in property <bool> scene_fixed_positions;
    in property <bool> scene_has_timestamp;
    in property <int> scene_timestamp_minutes;
    in property <int> scene_timestamp_seconds;
    in property <int> scene_timestamp_millis;

    in property <string> comment;
    in property <string> name;
    in property <string> subtitle;
    in-out property <Date> date: { day: root.today[0], month: root.today[1], year: root.today[2] };
    in property <string> variation;
    in property <string> author;
    in property <string> description;

    in property <bool> positions_at_side;
    in property <bool> grid_lines;
    in property <bool> snap_to_grid;
    in property <bool> show_timestamps;
    in property <bool> show_legend;
    in property <float> transparency;

    in property <[int]> floor_size_options;
    in property <int> floor_front;
    in property <int> floor_back;
    in property <int> floor_left;
    in property <int> floor_right;

    in property <[string]> grid_size_options;
    in property <int> grid_resolution_index;

    callback update_scene_name(string);
    callback update_scene_text(string);
    callback update_scene_fixed_positions(bool);
    callback update_scene_has_timestamp(bool);
    callback update_scene_timestamp_parts(int, int, int);

    callback update_comment(string);
    callback update_name(string);
    callback update_subtitle(string);
    callback update_date_parts(int, int, int);
    callback update_variation(string);
    callback update_author(string);
    callback update_description(string);

    callback update_positions_at_side(bool);
    callback update_grid_lines(bool);
    callback update_snap_to_grid(bool);
    callback update_show_timestamps(bool);
    callback update_show_legend(bool);
    callback update_transparency(float);

    callback update_floor_front(int);
    callback update_floor_back(int);
    callback update_floor_left(int);
    callback update_floor_right(int);
    callback update_grid_resolution(int);

    background: MaterialPalette.surface_variant;
    padding: 8px;

    preferred-height: content.preferred-height;
    height: content.preferred-height;

    content := Vertical {
        spacing: 12px;

        Rectangle {
            background: MaterialPalette.surface_container;
            border-width: 1px;
            border-color: MaterialPalette.outline_variant;
            border-radius: 8px;
            padding: 12px;

            Vertical {
                spacing: 8px;
                MaterialText {
                    text: Translations.scene_section_title;
                    font-size: 18px;
                }
                TextField {
                    label: Translations.scene_name_label;
                    text: scene_name;
                    enabled: has_selected_scene;
                    edited(new_value) => { update_scene_name(new_value); }
                }
                TextField {
                    label: Translations.scene_text_label;
                    text: scene_text;
                    enabled: has_selected_scene;
                    edited(new_value) => { update_scene_text(new_value); }
                }
                CheckBoxTile {
                    text: Translations.scene_fixed_positions_label;
                    check_state: scene_fixed_positions ? CheckState.checked : CheckState.unchecked;
                    enabled: has_selected_scene;
                    checked_state_changed(state) => {
                        update_scene_fixed_positions(state == CheckState.checked);
                    }
                }
                CheckBoxTile {
                    text: Translations.scene_timestamp_label;
                    check_state: scene_has_timestamp ? CheckState.checked : CheckState.unchecked;
                    enabled: has_selected_scene;
                    checked_state_changed(state) => {
                        update_scene_has_timestamp(state == CheckState.checked);
                    }
                }
            }
        }

        Rectangle {
            background: MaterialPalette.surface_container;
            border-width: 1px;
            border-color: MaterialPalette.outline_variant;
            border-radius: 8px;
            padding: 12px;

            Vertical {
                spacing: 8px;
                MaterialText { text: Translations.choreography_section_title; font-size: 18px; }
                TextField { label: Translations.choreography_name_placeholder; text: name; edited(v) => { update_name(v); } }
                TextField { label: Translations.choreography_subtitle_placeholder; text: subtitle; edited(v) => { update_subtitle(v); } }
                TextField {
                    label: "Date";
                    read_only: true;
                    text: date.year + "-" + date.month + "-" + date.day;
                    trailing_icon: @image-url("icons/CalendarToday.svg");
                    trailing_icon_clicked => { date_picker.show(); }
                }
                TextField { label: Translations.choreography_variation_placeholder; text: variation; edited(v) => { update_variation(v); } }
                TextField { label: Translations.choreography_author_placeholder; text: author; edited(v) => { update_author(v); } }
                TextField { label: Translations.choreography_comment_placeholder; text: comment; edited(v) => { update_comment(v); } }
                TextField { label: Translations.choreography_description_placeholder; text: description; edited(v) => { update_description(v); } }
            }

            date_picker := DatePickerPopup {
                title: "Date";
                date <=> root.date;

                accepted(date) => {
                    root.date = date;
                    root.update_date_parts(date.year, date.month, date.day);
                    date_picker.close();
                }
            }
        }

        Rectangle {
            background: MaterialPalette.surface_container;
            border-width: 1px;
            border-color: MaterialPalette.outline_variant;
            border-radius: 8px;
            padding: 12px;

            Vertical {
                spacing: 8px;
                MaterialText { text: Translations.choreography_floor_title; font-size: 18px; }
                CheckBoxTile {
                    text: Translations.choreography_positions_at_side_label;
                    check_state: positions_at_side ? CheckState.checked : CheckState.unchecked;
                    checked_state_changed(state) => {
                        update_positions_at_side(state == CheckState.checked);
                    }
                }
                CheckBoxTile {
                    text: Translations.choreography_grid_lines_label;
                    check_state: grid_lines ? CheckState.checked : CheckState.unchecked;
                    checked_state_changed(state) => {
                        update_grid_lines(state == CheckState.checked);
                    }
                }
                CheckBoxTile {
                    text: Translations.choreography_snap_to_grid_label;
                    check_state: snap_to_grid ? CheckState.checked : CheckState.unchecked;
                    checked_state_changed(state) => {
                        update_snap_to_grid(state == CheckState.checked);
                    }
                }
                CheckBoxTile {
                    text: Translations.choreography_show_timestamps_label;
                    check_state: show_timestamps ? CheckState.checked : CheckState.unchecked;
                    checked_state_changed(state) => {
                        update_show_timestamps(state == CheckState.checked);
                    }
                }
                CheckBoxTile {
                    text: Translations.choreography_show_legend_label;
                    check_state: show_legend ? CheckState.checked : CheckState.unchecked;
                    checked_state_changed(state) => {
                        update_show_legend(state == CheckState.checked);
                    }
                }
                MaterialText { text: Translations.choreography_transparency_label; }
                Slider {
                    minimum: 0;
                    maximum: 1;
                    value: transparency;
                    value_changed(value) => { update_transparency(value); }
                }
            }
        }
    }

}
