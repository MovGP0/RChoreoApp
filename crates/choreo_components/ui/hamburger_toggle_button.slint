import { MaterialAnimations, MaterialPalette, StateLayerArea } from "@material";

export component HamburgerToggleButton inherits Rectangle {
    in-out property <bool> checked: false;
    in property <bool> enabled: true;
    in property <bool> toggle_on_click: true;
    in property <length> content_padding: 10px;
    in property <length> corner_radius: 8px;
    in property <string> tooltip;
    in property <length> tooltip_offset: root.height / 2 + root.bar_thickness;
    in property <color> bar_color: MaterialPalette.on_surface;
    in property <color> checked_bar_color: MaterialPalette.primary;
    in property <color> disabled_bar_color: MaterialPalette.on_surface_variant;
    in property <color> background_checked_color: transparent;
    in property <float> pressed_opacity: 0.85;
    in property <duration> animation_duration: MaterialAnimations.emphasized_duration;

    callback clicked();
    callback toggled(bool);

    min-width: 40px;
    min-height: 40px;
    border-radius: root.height / 2;
    background: root.checked ? root.background_checked_color : transparent;
    opacity: root.enabled ? (state_layer_area.pressed ? root.pressed_opacity : 1) : 0.38;

    property <float> content_width_px: Math.max(0.0, (root.width - root.content_padding * 2) / 1px);
    property <float> content_height_px: Math.max(0.0, (root.height - root.content_padding * 2) / 1px);
    property <length> content_width: content_width_px * 1px;
    property <length> content_height: content_height_px * 1px;
    property <float> bar_thickness_px: Math.max(1.0, Math.min(content_width_px, content_height_px) * 0.08);
    property <length> bar_thickness: bar_thickness_px * 1px;
    property <float> bar_inset_px: Math.max(1.0, bar_thickness_px);
    property <length> bar_inset: bar_inset_px * 1px;
    property <float> bar_spacing_px: Math.max(
        0.0,
        Math.min((content_height_px - 2 * bar_inset_px) / 4, content_height_px * 0.2)
    );
    property <length> bar_spacing: bar_spacing_px * 1px;
    property <length> bar_full_width: Math.max(0.0, content_width_px - bar_inset_px * 2) * 1px;
    property <length> bar_half_width: bar_full_width / 2;
    property <length> bar_mid_y: root.content_padding + content_height / 2 - bar_thickness / 2;
    property <color> state_layer_tint: MaterialPalette.on_surface_variant;
    property <color> state_layer_color: MaterialPalette.on_surface_variant;

    property <color> effective_bar_color: root.enabled
        ? (root.checked ? root.checked_bar_color : root.bar_color)
        : root.disabled_bar_color;

    state_layer_area := StateLayerArea {
        width: parent.width;
        height: parent.height;
        border_radius: root.height / 2;
        color: root.state_layer_tint;
        display_background: false;
        enabled: root.enabled;
        tooltip: root.tooltip;
        tooltip_offset: root.tooltip_offset;
        clip_ripple: true;

        clicked => {
            root.clicked();
            if (root.toggle_on_click) {
                root.checked = !root.checked;
            }
        }
    }

    bar1 := Rectangle {
        x: root.content_padding + root.bar_inset;
        y: root.bar_mid_y - root.bar_spacing;
        width: root.bar_full_width;
        height: root.bar_thickness;
        background: root.effective_bar_color;
        border-radius: root.bar_thickness / 2;
        transform-rotation: 0deg;
        transform-origin: { x: 0px, y: root.bar_thickness / 2 };

        animate x { duration: root.animation_duration; easing: MaterialAnimations.standard_easing; }
        animate y { duration: root.animation_duration; easing: MaterialAnimations.standard_easing; }
        animate width { duration: root.animation_duration; easing: MaterialAnimations.standard_easing; }
        animate transform-rotation { duration: root.animation_duration; easing: MaterialAnimations.standard_easing; }
        animate background { duration: MaterialAnimations.standard_decelerate_duration; easing: MaterialAnimations.standard_easing; }
    }

    bar2 := Rectangle {
        x: root.content_padding + root.bar_inset;
        y: root.bar_mid_y;
        width: root.bar_full_width;
        height: root.bar_thickness;
        background: root.effective_bar_color;
        border-radius: root.bar_thickness / 2;

        animate x { duration: root.animation_duration; easing: MaterialAnimations.standard_easing; }
        animate y { duration: root.animation_duration; easing: MaterialAnimations.standard_easing; }
        animate width { duration: root.animation_duration; easing: MaterialAnimations.standard_easing; }
        animate background { duration: MaterialAnimations.standard_decelerate_duration; easing: MaterialAnimations.standard_easing; }
    }

    bar3 := Rectangle {
        x: root.content_padding + root.bar_inset;
        y: root.bar_mid_y + root.bar_spacing;
        width: root.bar_full_width;
        height: root.bar_thickness;
        background: root.effective_bar_color;
        border-radius: root.bar_thickness / 2;
        transform-rotation: 0deg;
        transform-origin: { x: 0px, y: root.bar_thickness / 2 };

        animate x { duration: root.animation_duration; easing: MaterialAnimations.standard_easing; }
        animate y { duration: root.animation_duration; easing: MaterialAnimations.standard_easing; }
        animate width { duration: root.animation_duration; easing: MaterialAnimations.standard_easing; }
        animate transform-rotation { duration: root.animation_duration; easing: MaterialAnimations.standard_easing; }
        animate background { duration: MaterialAnimations.standard_decelerate_duration; easing: MaterialAnimations.standard_easing; }
    }

    states [
        checked when root.checked: {
            root.state_layer_tint: MaterialPalette.primary;
            bar1.y: root.bar_mid_y;
            bar1.width: root.bar_half_width;
            bar1.transform-rotation: -35deg;
            bar2.width: root.bar_full_width;
            bar3.y: root.bar_mid_y;
            bar3.width: root.bar_half_width;
            bar3.transform-rotation: 35deg;
        }
    ]


    changed checked => {
        root.toggled(root.checked);
    }
}
