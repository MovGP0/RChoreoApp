import { MaterialAnimations, MaterialPalette, MenuItem, ScrollView } from "@material";
import { ChoreographySettingsView } from "choreography_settings_view.slint";
import { SceneListItem, ScenesPaneView } from "scenes_pane_view.slint";
import { Date } from "std-widgets.slint";

component MainPageLeftDrawer inherits Rectangle {
    in property <[SceneListItem]> scenes;
    in property <string> scenes_search_text;
    in property <bool> scenes_show_timestamps;
    in property <bool> scenes_can_save_choreo;
    in property <bool> scenes_can_delete_scene;
    in property <bool> scenes_can_navigate_to_settings;
    in property <bool> scenes_can_navigate_to_dancer_settings;

    callback scenes_select_scene(int);
    callback scenes_update_search_text(string);
    callback scenes_add_scene_before();
    callback scenes_add_scene_after();
    callback scenes_delete_scene();
    callback scenes_open_choreo();
    callback scenes_save_choreo();
    callback scenes_navigate_to_settings();
    callback scenes_navigate_to_dancer_settings();

    background: transparent;

    ScenesPaneView {
        width: parent.width;
        height: parent.height;
        scenes: root.scenes;
        search_text: root.scenes_search_text;
        show_timestamps: root.scenes_show_timestamps;
        can_save_choreo: root.scenes_can_save_choreo;
        can_delete_scene: root.scenes_can_delete_scene;
        can_navigate_to_settings: root.scenes_can_navigate_to_settings;
        can_navigate_to_dancer_settings: root.scenes_can_navigate_to_dancer_settings;

        select_scene(index) => { root.scenes_select_scene(index); }
        update_search_text(value) => { root.scenes_update_search_text(value); }
        add_scene_before => { root.scenes_add_scene_before(); }
        add_scene_after => { root.scenes_add_scene_after(); }
        delete_scene => { root.scenes_delete_scene(); }
        open_choreo => { root.scenes_open_choreo(); }
        save_choreo => { root.scenes_save_choreo(); }
        navigate_to_settings => { root.scenes_navigate_to_settings(); }
        navigate_to_dancer_settings => { root.scenes_navigate_to_dancer_settings(); }
    }
}

component MainPageRightDrawer inherits Rectangle {
    in property <bool> has_selected_scene;
    in property <string> scene_name;
    in property <string> scene_text;
    in property <bool> scene_fixed_positions;
    in property <bool> scene_has_timestamp;
    in property <int> scene_timestamp_minutes;
    in property <int> scene_timestamp_seconds;
    in property <int> scene_timestamp_millis;
    in-out property <color> scene_color;

    in property <string> comment;
    in property <string> name;
    in property <string> subtitle;
    in-out property <Date> date;
    in property <string> date_label;
    in property <string> date_picker_title;
    in property <string> variation;
    in property <string> author;
    in property <string> description;

    in property <bool> positions_at_side;
    in property <bool> draw_path_from;
    in property <bool> draw_path_to;
    in property <bool> grid_lines;
    in property <bool> snap_to_grid;
    in property <bool> show_timestamps;
    in property <bool> show_legend;
    in property <float> transparency;
    in-out property <color> floor_color;

    in property <[int]> floor_size_options;
    in property <int> floor_front;
    in property <int> floor_back;
    in property <int> floor_left;
    in property <int> floor_right;

    in property <[MenuItem]> grid_size_options;
    in property <int> grid_resolution_index;

    callback update_scene_name(string);
    callback update_scene_text(string);
    callback update_scene_fixed_positions(bool);
    callback update_scene_has_timestamp(bool);
    callback update_scene_timestamp_parts(int, int, int);
    callback update_scene_color(color);

    callback update_comment(string);
    callback update_name(string);
    callback update_subtitle(string);
    callback update_date_parts(int, int, int);
    callback update_variation(string);
    callback update_author(string);
    callback update_description(string);

    callback update_positions_at_side(bool);
    callback update_draw_path_from(bool);
    callback update_draw_path_to(bool);
    callback update_grid_lines(bool);
    callback update_snap_to_grid(bool);
    callback update_show_timestamps(bool);
    callback update_show_legend(bool);
    callback update_transparency(float);
    callback update_floor_color(color);

    callback update_floor_front(int);
    callback update_floor_back(int);
    callback update_floor_left(int);
    callback update_floor_right(int);
    callback update_grid_resolution(int);

    background: transparent;

    ScrollView {
        width: parent.width;
        height: parent.height;
        vertical_scrollbar_policy: ScrollBarPolicy.always_on;
        horizontal_scrollbar_policy: ScrollBarPolicy.always_off;

        settings_view := ChoreographySettingsView {
            width: parent.width;
            has_selected_scene: root.has_selected_scene;
            scene_name: root.scene_name;
            scene_text: root.scene_text;
            scene_fixed_positions: root.scene_fixed_positions;
            scene_has_timestamp: root.scene_has_timestamp;
            scene_timestamp_minutes: root.scene_timestamp_minutes;
            scene_timestamp_seconds: root.scene_timestamp_seconds;
            scene_timestamp_millis: root.scene_timestamp_millis;
            scene_color <=> root.scene_color;

            comment: root.comment;
            name: root.name;
            subtitle: root.subtitle;
            date <=> root.date;
            date_label: root.date_label;
            date_picker_title: root.date_picker_title;
            variation: root.variation;
            author: root.author;
            description: root.description;

            positions_at_side: root.positions_at_side;
            draw_path_from: root.draw_path_from;
            draw_path_to: root.draw_path_to;
            grid_lines: root.grid_lines;
            snap_to_grid: root.snap_to_grid;
            show_timestamps: root.show_timestamps;
            show_legend: root.show_legend;
            transparency: root.transparency;
            floor_color <=> root.floor_color;
            floor_size_options: root.floor_size_options;
            floor_front: root.floor_front;
            floor_back: root.floor_back;
            floor_left: root.floor_left;
            floor_right: root.floor_right;
            grid_size_options: root.grid_size_options;
            grid_resolution_index: root.grid_resolution_index;

            update_scene_name(value) => { root.update_scene_name(value); }
            update_scene_text(value) => { root.update_scene_text(value); }
            update_scene_fixed_positions(value) => { root.update_scene_fixed_positions(value); }
            update_scene_has_timestamp(value) => { root.update_scene_has_timestamp(value); }
            update_scene_timestamp_parts(minutes, seconds, millis) => {
                root.update_scene_timestamp_parts(minutes, seconds, millis);
            }
            update_scene_color(color) => { root.update_scene_color(color); }

            update_comment(value) => { root.update_comment(value); }
            update_name(value) => { root.update_name(value); }
            update_subtitle(value) => { root.update_subtitle(value); }
            update_date_parts(year, month, day) => {
                root.update_date_parts(year, month, day);
            }
            update_variation(value) => { root.update_variation(value); }
            update_author(value) => { root.update_author(value); }
            update_description(value) => { root.update_description(value); }

            update_positions_at_side(value) => { root.update_positions_at_side(value); }
            update_draw_path_from(value) => { root.update_draw_path_from(value); }
            update_draw_path_to(value) => { root.update_draw_path_to(value); }
            update_grid_lines(value) => { root.update_grid_lines(value); }
            update_snap_to_grid(value) => { root.update_snap_to_grid(value); }
            update_show_timestamps(value) => { root.update_show_timestamps(value); }
            update_show_legend(value) => { root.update_show_legend(value); }
            update_transparency(value) => { root.update_transparency(value); }
            update_floor_color(color) => { root.update_floor_color(color); }

            update_floor_front(value) => { root.update_floor_front(value); }
            update_floor_back(value) => { root.update_floor_back(value); }
            update_floor_left(value) => { root.update_floor_left(value); }
            update_floor_right(value) => { root.update_floor_right(value); }
            update_grid_resolution(value) => { root.update_grid_resolution(value); }
        }

        viewport_height: settings_view.height;
    }
}

export component MainPageDrawerHost inherits Rectangle {
    in property <length> left_drawer_width: 320px;
    in property <length> right_drawer_width: 320px;
    in property <length> top_inset: 0px;
    in property <bool> inline_left: false;
    in-out property <bool> is_left_open: false;
    in-out property <bool> is_right_open: false;
    in property <bool> left_close_on_click_away: true;
    in property <bool> right_close_on_click_away: true;
    in property <color> overlay_color: MaterialPalette.background_modal;
    in property <color> drawer_background: MaterialPalette.surface_container_low;
    in property <[SceneListItem]> scenes;
    in property <string> scenes_search_text;
    in property <bool> scenes_show_timestamps;
    in property <bool> scenes_can_save_choreo;
    in property <bool> scenes_can_delete_scene;
    in property <bool> scenes_can_navigate_to_settings;
    in property <bool> scenes_can_navigate_to_dancer_settings;
    in property <bool> has_selected_scene;
    in property <string> scene_name;
    in property <string> scene_text;
    in property <bool> scene_fixed_positions;
    in property <bool> scene_has_timestamp;
    in property <int> scene_timestamp_minutes;
    in property <int> scene_timestamp_seconds;
    in property <int> scene_timestamp_millis;
    in-out property <color> scene_color;
    in property <string> comment;
    in property <string> name;
    in property <string> subtitle;
    in-out property <Date> date;
    in property <string> date_label;
    in property <string> date_picker_title;
    in property <string> variation;
    in property <string> author;
    in property <string> description;
    in property <bool> positions_at_side;
    in property <bool> draw_path_from;
    in property <bool> draw_path_to;
    in property <bool> grid_lines;
    in property <bool> snap_to_grid;
    in property <bool> show_timestamps;
    in property <bool> show_legend;
    in property <float> transparency;
    in-out property <color> floor_color;
    in property <[int]> floor_size_options;
    in property <int> floor_front;
    in property <int> floor_back;
    in property <int> floor_left;
    in property <int> floor_right;
    in property <[MenuItem]> grid_size_options;
    in property <int> grid_resolution_index;

    callback overlay_clicked();
    callback left_close_requested();
    callback right_close_requested();
    callback scenes_select_scene(int);
    callback scenes_update_search_text(string);
    callback scenes_add_scene_before();
    callback scenes_add_scene_after();
    callback scenes_delete_scene();
    callback scenes_open_choreo();
    callback scenes_save_choreo();
    callback scenes_navigate_to_settings();
    callback scenes_navigate_to_dancer_settings();
    callback update_scene_name(string);
    callback update_scene_text(string);
    callback update_scene_fixed_positions(bool);
    callback update_scene_has_timestamp(bool);
    callback update_scene_timestamp_parts(int, int, int);
    callback update_scene_color(color);
    callback update_comment(string);
    callback update_name(string);
    callback update_subtitle(string);
    callback update_date_parts(int, int, int);
    callback update_variation(string);
    callback update_author(string);
    callback update_description(string);
    callback update_positions_at_side(bool);
    callback update_draw_path_from(bool);
    callback update_draw_path_to(bool);
    callback update_grid_lines(bool);
    callback update_snap_to_grid(bool);
    callback update_show_timestamps(bool);
    callback update_show_legend(bool);
    callback update_transparency(float);
    callback update_floor_color(color);
    callback update_floor_front(int);
    callback update_floor_back(int);
    callback update_floor_left(int);
    callback update_floor_right(int);
    callback update_grid_resolution(int);

    property <length> inline_left_width: root.inline_left && root.is_left_open
        ? root.left_drawer_width
        : 0px;
    property <bool> overlay_visible: (root.is_left_open && !root.inline_left && root.left_close_on_click_away)
        || (root.is_right_open && root.right_close_on_click_away);

    clip: true;

    content := Rectangle {
        x: root.inline_left_width;
        y: root.top_inset;
        width: parent.width - root.inline_left_width;
        height: parent.height - root.top_inset;
        background: transparent;
        z: 0;

        @children
    }

    overlay := TouchArea {
        visible: root.overlay_visible;
        enabled: root.overlay_visible;
        width: parent.width;
        height: parent.height;
        z: 1;

        Rectangle {
            width: parent.width;
            height: parent.height;
            background: root.overlay_color;
        }

        clicked => {
            if (root.left_close_on_click_away && root.is_left_open) {
                root.left_close_requested();
            }
            if (root.right_close_on_click_away && root.is_right_open) {
                root.right_close_requested();
            }
            if (root.left_close_on_click_away) {
                root.is_left_open = false;
            }
            if (root.right_close_on_click_away) {
                root.is_right_open = false;
            }
            root.overlay_clicked();
        }
    }

    panel_area := Rectangle {
        x: 0px;
        y: root.top_inset;
        width: parent.width;
        height: parent.height - root.top_inset;
        background: transparent;
        z: 2;

        left_panel := Rectangle {
            visible: root.inline_left || root.is_left_open;
            x: root.inline_left ? 0px : (root.is_left_open ? 0px : -self.width);
            y: 0px;
            width: root.left_drawer_width;
            height: parent.height;
            background: root.drawer_background;
            z: 2;

            animate x {
                duration: MaterialAnimations.standard_decelerate_duration;
                easing: MaterialAnimations.standard_easing;
            }

            MainPageLeftDrawer {
                width: parent.width;
                height: parent.height;
                scenes: root.scenes;
                scenes_search_text: root.scenes_search_text;
                scenes_show_timestamps: root.scenes_show_timestamps;
                scenes_can_save_choreo: root.scenes_can_save_choreo;
                scenes_can_delete_scene: root.scenes_can_delete_scene;
                scenes_can_navigate_to_settings: root.scenes_can_navigate_to_settings;
                scenes_can_navigate_to_dancer_settings: root.scenes_can_navigate_to_dancer_settings;

                scenes_select_scene(index) => { root.scenes_select_scene(index); }
                scenes_update_search_text(value) => { root.scenes_update_search_text(value); }
                scenes_add_scene_before => { root.scenes_add_scene_before(); }
                scenes_add_scene_after => { root.scenes_add_scene_after(); }
                scenes_delete_scene => { root.scenes_delete_scene(); }
                scenes_open_choreo => { root.scenes_open_choreo(); }
                scenes_save_choreo => { root.scenes_save_choreo(); }
                scenes_navigate_to_settings => { root.scenes_navigate_to_settings(); }
                scenes_navigate_to_dancer_settings => { root.scenes_navigate_to_dancer_settings(); }
            }
        }

        right_panel := Rectangle {
            visible: root.is_right_open;
            x: root.is_right_open ? parent.width - root.right_drawer_width : parent.width;
            y: 0px;
            width: root.right_drawer_width;
            height: parent.height;
            background: root.drawer_background;
            z: 2;

            animate x {
                duration: MaterialAnimations.standard_decelerate_duration;
                easing: MaterialAnimations.standard_easing;
            }

            MainPageRightDrawer {
                width: parent.width;
                height: parent.height;
                has_selected_scene: root.has_selected_scene;
                scene_name: root.scene_name;
                scene_text: root.scene_text;
                scene_fixed_positions: root.scene_fixed_positions;
                scene_has_timestamp: root.scene_has_timestamp;
                scene_timestamp_minutes: root.scene_timestamp_minutes;
                scene_timestamp_seconds: root.scene_timestamp_seconds;
                scene_timestamp_millis: root.scene_timestamp_millis;
                scene_color <=> root.scene_color;
                comment: root.comment;
                name: root.name;
                subtitle: root.subtitle;
                date <=> root.date;
                date_label: root.date_label;
                date_picker_title: root.date_picker_title;
                variation: root.variation;
                author: root.author;
                description: root.description;
                positions_at_side: root.positions_at_side;
                draw_path_from: root.draw_path_from;
                draw_path_to: root.draw_path_to;
                grid_lines: root.grid_lines;
                snap_to_grid: root.snap_to_grid;
                show_timestamps: root.show_timestamps;
                show_legend: root.show_legend;
                transparency: root.transparency;
                floor_color <=> root.floor_color;
                floor_size_options: root.floor_size_options;
                floor_front: root.floor_front;
                floor_back: root.floor_back;
                floor_left: root.floor_left;
                floor_right: root.floor_right;
                grid_size_options: root.grid_size_options;
                grid_resolution_index: root.grid_resolution_index;

                update_scene_name(value) => { root.update_scene_name(value); }
                update_scene_text(value) => { root.update_scene_text(value); }
                update_scene_fixed_positions(value) => { root.update_scene_fixed_positions(value); }
                update_scene_has_timestamp(value) => { root.update_scene_has_timestamp(value); }
                update_scene_timestamp_parts(minutes, seconds, millis) => {
                    root.update_scene_timestamp_parts(minutes, seconds, millis);
                }
                update_scene_color(color) => { root.update_scene_color(color); }
                update_comment(value) => { root.update_comment(value); }
                update_name(value) => { root.update_name(value); }
                update_subtitle(value) => { root.update_subtitle(value); }
                update_date_parts(year, month, day) => {
                    root.update_date_parts(year, month, day);
                }
                update_variation(value) => { root.update_variation(value); }
                update_author(value) => { root.update_author(value); }
                update_description(value) => { root.update_description(value); }
                update_positions_at_side(value) => { root.update_positions_at_side(value); }
                update_draw_path_from(value) => { root.update_draw_path_from(value); }
                update_draw_path_to(value) => { root.update_draw_path_to(value); }
                update_grid_lines(value) => { root.update_grid_lines(value); }
                update_snap_to_grid(value) => { root.update_snap_to_grid(value); }
                update_show_timestamps(value) => { root.update_show_timestamps(value); }
                update_show_legend(value) => { root.update_show_legend(value); }
                update_transparency(value) => { root.update_transparency(value); }
                update_floor_color(color) => { root.update_floor_color(color); }
                update_floor_front(value) => { root.update_floor_front(value); }
                update_floor_back(value) => { root.update_floor_back(value); }
                update_floor_left(value) => { root.update_floor_left(value); }
                update_floor_right(value) => { root.update_floor_right(value); }
                update_grid_resolution(value) => { root.update_grid_resolution(value); }
            }
        }
    }
}
