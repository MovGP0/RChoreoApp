import { Horizontal, IconButton, MaterialPalette, MaterialText, MaterialTypography, Slider } from "@material";
import { AudioPlayerInfo } from "audio_player_info.slint";
import { SliderWithTicks } from "slider_with_ticks.slint";

export component AudioPlayerView inherits Rectangle {
    background: MaterialPalette.surface_container_low;
    border-width: 1px;
    border-color: MaterialPalette.outline;
    border-radius: 8px;

    content := Horizontal {
        width: parent.width;
        height: parent.height;
        padding: 12px;
        spacing: 12px;

        Slider {
            // Material Slider currently assumes a zero-based range when translating
            // pointer positions; normalize speed to avoid collapsing to minimum.
            minimum: 0;
            maximum: 100;
            value: AudioPlayerInfo.maximum_speed == AudioPlayerInfo.minimum_speed
                ? 0
                : (AudioPlayerInfo.speed - AudioPlayerInfo.minimum_speed)
                    / (AudioPlayerInfo.maximum_speed - AudioPlayerInfo.minimum_speed) * 100;
            width: 240px;
            value_changed(value) => {
                let span = AudioPlayerInfo.maximum_speed - AudioPlayerInfo.minimum_speed;
                AudioPlayerInfo.speed_changed(
                    span == 0
                        ? AudioPlayerInfo.minimum_speed
                        : AudioPlayerInfo.minimum_speed + span * (value / 100)
                );
            }
        }

        MaterialText {
            text: AudioPlayerInfo.speed_label;
            color: MaterialPalette.on_surface_variant;
            font-size: MaterialTypography.label_large.font_size;
            font-weight: MaterialTypography.label_large.font_weight;
            horizontal-alignment: right;
            vertical-alignment: center;
        }

        SliderWithTicks {
            minimum: 0;
            maximum: AudioPlayerInfo.duration;
            value: AudioPlayerInfo.position;
            enabled: AudioPlayerInfo.can_seek;
            tick_color: MaterialPalette.tertiary;
            value_changed(value) => { AudioPlayerInfo.position_changed(value); }
            drag_started => { AudioPlayerInfo.position_drag_started(); }
            drag_completed(value) => { AudioPlayerInfo.position_drag_completed(value); }
            tick_values: AudioPlayerInfo.tick_values;
        }

        MaterialText {
            text: AudioPlayerInfo.duration_label;
            color: MaterialPalette.on_surface_variant;
            font-size: MaterialTypography.label_large.font_size;
            font-weight: MaterialTypography.label_large.font_weight;
            width: 64px;
            vertical-alignment: center;
        }

        IconButton {
            icon: @image-url("../../ui/icons/Link.svg");
            enabled: AudioPlayerInfo.can_link_scene_to_position;
            clicked => { AudioPlayerInfo.link_scene_to_position(); }
        }

        IconButton {
            icon: AudioPlayerInfo.is_playing
                ? @image-url("../../ui/icons/Pause.svg")
                : @image-url("../../ui/icons/Play.svg");
            clicked => { AudioPlayerInfo.toggle_play_pause(); }
        }
    }
}
